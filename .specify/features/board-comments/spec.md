# Feature Specification: 게시판 댓글 기능

**Feature Branch**: `001-board-comments`
**Created**: 2025-01-21
**Status**: Draft
**Input**: 사용자가 게시글에 댓글을 작성하고 관리할 수 있는 기능

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 댓글 작성 및 조회 (Priority: P1)

사용자는 게시글을 읽고 자신의 의견을 댓글로 남길 수 있어야 합니다. 댓글은 게시글 하단에 시간순으로 표시됩니다.

**Why this priority**: 댓글 기본 기능은 사용자 참여를 유도하는 핵심 기능으로 최우선 구현이 필요합니다.

**Independent Test**: 로그인한 사용자가 게시글 상세 페이지에서 댓글을 작성하고 저장하면, 해당 댓글이 즉시 게시글 하단에 표시되는지 확인합니다.

**Acceptance Scenarios**:

1. **Given** 로그인한 사용자가 게시글 상세 페이지에 있고, **When** 댓글 입력창에 텍스트를 입력하고 "등록" 버튼을 클릭하면, **Then** 댓글이 저장되고 게시글 하단에 작성자, 내용, 작성시간과 함께 표시됩니다.
2. **Given** 게시글에 댓글이 3개 존재하고, **When** 사용자가 게시글을 조회하면, **Then** 모든 댓글이 작성시간 순으로 표시됩니다.
3. **Given** 비로그인 사용자가 게시글을 조회할 때, **When** 댓글 목록을 확인하면, **Then** 댓글을 볼 수 있지만 댓글 입력창은 표시되지 않습니다.

---

### User Story 2 - 댓글 수정 및 삭제 (Priority: P2)

사용자는 자신이 작성한 댓글을 수정하거나 삭제할 수 있어야 합니다. 관리자는 모든 댓글을 관리할 수 있습니다.

**Why this priority**: 사용자가 작성한 내용을 관리할 수 있는 기능으로 사용자 경험 향상에 필요합니다.

**Independent Test**: 댓글 작성자 또는 관리자가 댓글의 "수정" 또는 "삭제" 버튼을 클릭하여 댓글을 변경하거나 제거할 수 있는지 확인합니다.

**Acceptance Scenarios**:

1. **Given** 사용자가 자신이 작성한 댓글을 보고 있고, **When** "수정" 버튼을 클릭하고 내용을 변경한 후 "저장"을 클릭하면, **Then** 댓글이 수정되고 "(수정됨)" 표시가 추가됩니다.
2. **Given** 사용자가 자신이 작성한 댓글을 보고 있고, **When** "삭제" 버튼을 클릭하고 확인 팝업에서 "예"를 선택하면, **Then** 댓글이 목록에서 제거됩니다.
3. **Given** 관리자가 다른 사용자의 댓글을 보고 있고, **When** "삭제" 버튼을 클릭하면, **Then** 해당 댓글이 삭제됩니다.
4. **Given** 일반 사용자가 다른 사용자의 댓글을 보고 있고, **When** 댓글을 확인하면, **Then** "수정" 및 "삭제" 버튼이 표시되지 않습니다.

---

### User Story 3 - 댓글 개수 표시 및 알림 (Priority: P3)

게시글 목록에서 각 게시글의 댓글 개수가 표시되어, 사용자가 활발한 토론이 있는 게시글을 쉽게 확인할 수 있습니다.

**Why this priority**: 사용자 참여도를 시각적으로 보여주어 커뮤니티 활성화를 촉진하는 부가 기능입니다.

**Independent Test**: 게시글 목록 페이지에서 각 게시글 옆에 댓글 개수가 표시되고, 댓글이 추가되면 실시간으로 업데이트되는지 확인합니다.

**Acceptance Scenarios**:

1. **Given** 게시글에 댓글이 5개 존재하고, **When** 사용자가 게시글 목록을 조회하면, **Then** 해당 게시글 옆에 "댓글 5"가 표시됩니다.
2. **Given** 사용자가 게시글에 새 댓글을 작성하고, **When** 게시글 목록으로 돌아가면, **Then** 댓글 개수가 증가하여 표시됩니다.

---

### Edge Cases

- 댓글 내용이 비어있을 때: 입력 검증을 통해 "댓글 내용을 입력해주세요" 오류 메시지 표시
- 댓글 길이가 1000자를 초과할 때: "댓글은 1000자 이내로 작성해주세요" 오류 메시지 표시
- 삭제된 게시글의 댓글 조회 시: 404 오류 또는 "존재하지 않는 게시글입니다" 메시지 표시
- 동시에 같은 댓글을 수정하려는 경우: 낙관적 잠금을 통해 "다른 사용자가 수정했습니다. 새로고침 후 다시 시도해주세요" 메시지 표시
- XSS 공격 시도 (예: `<script>alert('XSS')</script>`): Thymeleaf 자동 이스케이핑으로 HTML 태그가 텍스트로 표시됨

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 시스템은 로그인한 사용자가 게시글에 댓글을 작성할 수 있어야 합니다.
- **FR-002**: 시스템은 댓글 작성 시 작성자, 내용, 작성시간, 게시글 ID를 저장해야 합니다.
- **FR-003**: 시스템은 게시글 상세 페이지에서 해당 게시글의 모든 댓글을 작성시간 순으로 표시해야 합니다.
- **FR-004**: 사용자는 자신이 작성한 댓글을 수정 및 삭제할 수 있어야 합니다.
- **FR-005**: 관리자(ADMIN 권한)는 모든 댓글을 삭제할 수 있어야 합니다.
- **FR-006**: 시스템은 댓글 내용이 비어있거나 1000자를 초과하는 경우 저장을 거부하고 오류 메시지를 표시해야 합니다.
- **FR-007**: 시스템은 게시글 목록에서 각 게시글의 댓글 개수를 표시해야 합니다.
- **FR-008**: 시스템은 댓글 수정 시 수정시간을 기록하고 "(수정됨)" 표시를 추가해야 합니다.
- **FR-009**: 시스템은 댓글 작성, 수정, 삭제 시 XSS 공격을 방지하기 위해 입력값을 이스케이핑해야 합니다.
- **FR-010**: 비로그인 사용자는 댓글을 조회할 수 있지만 작성, 수정, 삭제는 불가능해야 합니다.

### Key Entities

- **Comment (댓글)**:
  - 속성: ID, 게시글 ID(외래키), 작성자 ID(외래키), 내용, 작성시간, 수정시간
  - 관계: 하나의 게시글에 여러 댓글이 연결됨 (N:1), 하나의 사용자가 여러 댓글 작성 가능 (N:1)
  - 제약: 내용은 1~1000자, 작성자와 게시글은 필수

- **Board (게시글)**:
  - 속성: 기존 속성 + 댓글 개수(계산 필드 또는 캐시)
  - 관계: 하나의 게시글이 여러 댓글을 가질 수 있음 (1:N)

- **User (사용자)**:
  - 관계: 하나의 사용자가 여러 댓글을 작성할 수 있음 (1:N)

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 사용자는 게시글 상세 페이지에서 5초 이내에 댓글을 작성하고 저장할 수 있습니다.
- **SC-002**: 댓글이 포함된 게시글 상세 페이지는 댓글 50개까지 2초 이내에 로드됩니다.
- **SC-003**: 댓글 입력 검증 오류 메시지는 1초 이내에 사용자에게 표시됩니다.
- **SC-004**: 관리자는 부적절한 댓글을 3초 이내에 삭제할 수 있습니다.
- **SC-005**: XSS 공격 시도는 100% 차단되어 스크립트가 실행되지 않습니다.
- **SC-006**: 댓글 작성 후 게시글 목록의 댓글 개수가 즉시 업데이트됩니다.
- **SC-007**: 단위 테스트 커버리지는 비즈니스 로직의 85% 이상을 달성합니다.
